### 01 自动化构建简介

自动化构建工作流，脱离运行环境兼容带来的问题，使用提高效率的语法，规范和标准。

- ECMAScript Next
- Sass
- 模板引擎

这些用法大都不被浏览器支持



### 02 自动化构建初体验

NPM Scripts编辑构建命令

```
//package.json
{
	"script" : {
		"build" : "sass scss/main.scss css/style.css"
	}
}
```



NPM Scripts是实现自动化构建工作流的最简方式

使用preserve，创建一个钩子，

```
//package.json
{
	"script" : {
		"build" : "sass scss/main.scss css/style.css --watch",
		"preserve": "yarn build",
		"serve" : "browser-sync"
	}
}
```

--watch来监听命令，文件变化时去执行，使用npm-run-all

```
//package.json
{
	"script" : {
		"build" : "sass scss/main.scss css/style.css --watch",
		"preserve": "yarn build",
		"serve" : "browser-sync --files\"css/*.css\"",
		"start" : "run-p build serve"
	}
}
```



### 03常用的自动化构建工具

- Grunt 
- Gulp
- FIS



### 04 Grunt基本使用

```
//1
yarn init -y
//2
yarn add grunt
//3添加一个gruntfile.js文件
code gruntfile.js

//4使用yarn grunt '函数名'去执行
```

```js
//Grunt 入口文件
//用于定义一些Grunt自动执行的任务
//需要导出一个函数
//次函数接收一个grunt的形参，内部提供一些创建任务时可以用到的api

module.exports = grunt => {
    //frunt注册函数
    grunt.registerTask('foo',()=>{
        console.log('hello grunt')
    })
    //第二个参数为字符串的话，则会成为描述
    grunt.registerTask('bar','任务描述',()=>{
        console.log('hello grunt')
    })

    //第一个参数为'default'则会变为grunt的默认任务，就不需要指定任务
    grunt.registerTask('default','任务描述',()=>{
        console.log('hello grunt')
    })

    //第二哥参数为数组，则会依次执行
    grunt.registerTask('default',['foo','bar'])

    //grunt中对异步的支持
    //这样写不会打印，因为grunt默认是同步的
    // grunt.registerTask('async-task',()=>{
    //     setTimeout(()=>{
    //         console.log('async task working')
    //     },1000)
    // })

    grunt.registerTask('async-task',function(){
        const done = this.async();
        setTimeout(()=>{
            console.log('async task working')
            done()
        },1000)
    })
}
```



### 05 Grunt标记任务失败

```
    //标记任务失败,后续任务也不回被执行
    grunt.registerTask('bad',()=>{
        console.log('bad')
        return false
    
    //异步任务标记失败
    grunt.registerTask('async-task',function(){
        const done = this.async();
        setTimeout(()=>{
            console.log('async task working')
            done(false)
        },1000)
    })
```

如果想继续执行可以在命令行加入--force

````
yarn grunt default --force
````



### 06Grunt的配置选项方法

```
//使用这个方法
crunt.initConfig({
	foo : 'bar'
})
```

```js
module.exports = grunt => {
    //使用这个方法
    grunt.initConfig({
        foo: 'bar'
    })
    grunt.registerTask('foo', () => {
        console.log(grunt.config('foo'))
        
    })
}
```

```
//使用这个方法
    grunt.initConfig({
        foo: {
            bar : 123
        } 
    })
    grunt.registerTask('foo', () => {
        console.log(grunt.config('foo.bar'))
        
    })
//可以使用yarn grunt foo拿到属性值
```



### 07Grunt多目标任务

使用grunt.registerMultiTask()



 ```js

module.exports = grunt => {
    grunt.initConfig({
        //build中每个键都会成为一个目标，除了option
        //option上的信息作为配置选项出现
        build: {
            options: {
                foo: 'bar'
            },
            css: {
                options: {
                    foo: 'bax'
                },
            },
            js: '2'
        }
    })
    //执行时会执行上面两个目标 yarn grunt build
    //yarn grunt build:css
    /*
        Running "build:css" (build) task
        { foo: 'bax' }
        target: css,data:[object Object]

        Running "build:js" (build) task
        { foo: 'bar' }
        target: js,data:2
    */
    grunt.registerMultiTask('build', function () {
        console.log(this.options())
        console.log(`target: ${this.target},data:${this.data}`)
    })
}
 ```



### 08 Grunt 插件的使用

- 先通过npm安装插件
- 再到Gruntfile中载入插件
- 使用grunt.loadNpmTasks调用插件

```js
grunt.initCofig({//为任务添加配置选项
	clean : {
		temp : 'temp/*.txt'//可以使用通配符
		//temp : 'temp/**
	}
})

grunt.loadNpmTasks('grunt-contrib-clean')
```



### 09Grunt常用插件和总结

- grunt-sass //npm模块

```
yarn add grunt-sass sass --dev
```

```
const sass = require('sass')

module.exports = grunt => {
    grunt.initConfig({
        sass: {
            options : {
                sourceMap : true,
                implementation : sass
            },
            main: {
                files: {
                    'dist/css/main.css': 'src/scss/main.scss' //键为输出路径，值为输入路径
                }
            }
        }
    })
    grunt.loadNpmTasks('grunt-sass')
}
```



- grunt-babel

```
yarn add grunt-babel @babel/core @babel/perset-env --dev
```

- 安装load-grunt-tasks解决频繁使用loadNpmTasks()方法



- grunt-contrib-watch 文件修改完成后自动取编译

编译文件

```js
const sass = require('sass')
const loadGruntTasks = require('load-grunt-tasks')

module.exports = grunt => {
    grunt.initConfig({
        sass: {
            options: {
                sourceMap: true,
                implementation: sass
            },
            main: {
                files: {
                    'dist/css/main.css': 'src/scss/main.scss' //键为输出路径，值为输入路径
                }
            }
        },
        babel: {
            main: {
                options: {
                    sourceMap: true,
                    presets: ['@babel/preset-env'] //转换最新特性
                },
                files: {
                    'dist/js/app.js': 'src/js/app.js' //键为输出路径，值为输入路径
                }
            }
        },
        watch : {
            js : {
                files : ["src/js/*.js"],
                tasks : ['babel']
            },
            css : {
                files : ["src/scss/*.scss"],
                tasks : ['babel']
            }
        }
    })
    // grunt.loadNpmTasks('grunt-sass')
    loadGruntTasks(grunt) //会自动加载所有的grunt插件中的任务

    grunt.registerTask('default',['sass','babel','watch'])
}
```



### 10Gulp的基本使用



